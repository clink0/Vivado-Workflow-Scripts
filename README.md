# Vivado Integrated Workflow Scripts

**The simplest way to go from Verilog files to working FPGA**

Just write your `.v` files in a folder, run one command, and either see simulation results or have your design running on the FPGA!

## ðŸŽ¯ Your Desired Workflow

```
Write .v files â†’ Run script â†’ See results
```

That's it! No project setup, no GUI clicking, no file management.

## ðŸ“¦ What You Get

### Two Simple Scripts:

1. **`run_simulation.py`** - Auto-creates project & runs simulation
2. **`run_hardware.py`** - Auto-creates project & programs FPGA

## ðŸš€ Quick Start

### Setup (One Time Only)

1. Put these scripts somewhere accessible (e.g., `~/scripts/` or `~/.local/bin/`)
2. Make them executable:
```bash
chmod +x run_simulation.py run_hardware.py
```

3. (Optional) Add to your PATH for even easier use

### Your Daily Workflow

#### Step 1: Create a folder with your Verilog files

```
my_project/
â”œâ”€â”€ my_design.v           # Your design module
â”œâ”€â”€ my_design_tb.v        # Your testbench (ends with _tb)
â””â”€â”€ Basys3_Master.xdc     # Constraint file (for hardware)
```

#### Step 2: Run simulation OR hardware

```bash
# For simulation
python ~/scripts/run_simulation.py .

# For hardware (synthesize + program FPGA)
python ~/scripts/run_hardware.py .
```

That's it! Really!

## ðŸ“‹ Detailed Usage

### Simulation Script

```bash
python run_simulation.py <directory> [options]
```

**Options:**
- `--time <duration>` - How long to simulate (default: 1000ns)
- `--board <name>` - Target board (default: basys3)

**Examples:**

```bash
# Run simulation in current directory
python run_simulation.py .

# Run for 5 microseconds
python run_simulation.py . --time 5us

# Run simulation in another directory
python run_simulation.py ~/my_fpga_lab/lab3 --time 500ns
```

### Hardware Script

```bash
python run_hardware.py <directory> [options]
```

**Options:**
- `--no-program` - Just generate bitstream, don't program
- `--board <name>` - Target board (default: basys3)

**Examples:**

```bash
# Full flow: synthesize + implement + program FPGA
python run_hardware.py .

# Generate bitstream but don't program
python run_hardware.py . --no-program

# Program a different board
python run_hardware.py . --board arty
```

## ðŸ“ File Naming Conventions

### The scripts automatically detect file types:

**Design Files** (anything.v):
- `my_module.v`
- `digital_safe.v`
- `home_alarm_top.v`

**Testbench Files** (must contain `_tb`, `_test`, or `testbench`):
- `my_module_tb.v` âœ…
- `testbench.v` âœ…
- `test_bench.v` âœ…
- `my_module_test.v` âœ…

**Constraint Files**:
- `Basys3_Master.xdc`
- `constraints.xdc`
- Any `*.xdc` file

**Top Module Detection:**
- Files with `_top` in the name are automatically set as top
- Otherwise, the first design file is used

## ðŸ“‚ What Happens Behind the Scenes

Both scripts do this:

1. **Scan your directory** for `.v` and `.xdc` files
2. **Create a fresh Vivado project** in `vivado_project/` subdirectory
3. **Add all files** automatically
4. **Set the top module** based on naming or content
5. **Run the workflow** (simulation or hardware)
6. **Show results** location

## ðŸ’¡ Example: Your Lab 3 Seven-Segment Display

Let's say you're working on Lab 3:

```bash
cd ~/fpga_labs/lab3

# Create your files
ls
# homeAlarm.v
# homeAlarm_tb.v
# Basys3_Master.xdc

# Test with simulation first
python ~/scripts/run_simulation.py . --time 1ms

# Looks good? Program the FPGA!
python ~/scripts/run_hardware.py .
```

Done! The seven-segment display is now running on your Basys3 board.

## ðŸŽ“ Example: Week 1 Modeling Exercises

For the different modeling styles (dataflow, structural, behavioral):

```bash
# Directory structure
week1_dataflow/
â”œâ”€â”€ first_system_merged.v     # Dataflow version
â”œâ”€â”€ first_system_tb.v          # Testbench
â””â”€â”€ Basys3_Master.xdc          # Constraints

# Test it
cd week1_dataflow
python ~/scripts/run_simulation.py . --time 400ns

# If it works, run on hardware
python ~/scripts/run_hardware.py .
```

Repeat for each modeling style - each in its own folder.

## ðŸ”§ Generated Files

Both scripts create a `vivado_project/` directory in your source folder:

```
my_project/
â”œâ”€â”€ my_design.v                    # Your files
â”œâ”€â”€ my_design_tb.v
â”œâ”€â”€ Basys3_Master.xdc
â”œâ”€â”€ vivado_project/                # Generated by scripts
â”‚   â”œâ”€â”€ my_project.xpr
â”‚   â”œâ”€â”€ my_project.sim/            # Simulation outputs
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚       â””â”€â”€ *.wdb             # Waveform database
â”‚   â””â”€â”€ my_project.runs/           # Hardware outputs
â”‚       â””â”€â”€ impl_1/
â”‚           â””â”€â”€ *.bit              # Bitstream file
â”œâ”€â”€ run_sim.tcl                    # Generated Tcl (can delete)
â””â”€â”€ run_hardware.tcl               # Generated Tcl (can delete)
```

**You can safely delete `vivado_project/` and the `.tcl` files anytime**
- They're regenerated fresh each time you run the scripts
- Keeps your source directory clean

## ðŸŽ¨ Viewing Simulation Waveforms

After `run_simulation.py` completes:

```bash
cd my_project
vivado -mode gui
```

Then in Vivado:
- File â†’ Open Waveform Database
- Navigate to `vivado_project/my_project.sim/sim_1/behav/xsim/`
- Select the `.wdb` file

Or the script will tell you the exact path!

## âš™ï¸ Customization

### Different Vivado Installation

Edit the scripts (near the bottom of `main()` function):

```python
# Change this line
vivado_path = "vivado"

# To your installation path
vivado_path = "/tools/Xilinx/Vivado/2023.2/bin/vivado"
```

### Add More Boards

Edit the `board_configs` dictionary in either script:

```python
board_configs = {
    "basys3": {
        "part": "xc7a35tcpg236-1",
        "board_part": "digilentinc.com:basys3:part0:1.2"
    },
    "my_custom_board": {
        "part": "xc7a100tcsg324-1",
        "board_part": "xilinx.com:ac701:part0:1.4"
    }
}
```

Then use: `--board my_custom_board`

## ðŸ†š vs. Your Old Workflow

**Old workflow:**
1. Open Vivado
2. Open existing project
3. Disable all current files
4. Add new files
5. Click through GUI for synthesis
6. Click through GUI for implementation
7. Click through GUI for bitstream
8. Click through GUI for programming

**New workflow:**
```bash
python run_hardware.py .
```

## ðŸ› ï¸ Common Issues

### "No Verilog design files found"
- Make sure your `.v` files are in the directory you specified
- Check that you're in the right directory

### "No testbench files found" (simulation only)
- Testbench filename must contain `_tb`, `_test`, or `testbench`
- Rename: `my_file.v` â†’ `my_file_tb.v`

### "No constraint file found" (hardware only)
- Add a `.xdc` file with pin constraints
- The script will warn you and ask if you want to continue

### "Could not connect to hardware target"
- Make sure FPGA board is connected via USB
- Ensure board is powered on
- Check that drivers are installed
- Use `--no-program` to just generate bitstream

### Simulation runs but no waveform appears
- Waveforms are saved as `.wdb` files
- Must open them manually in Vivado GUI
- The script tells you where to find them

## ðŸŽ¯ Pro Tips

### 1. Create Aliases

Add to your `~/.bashrc` or `~/.zshrc`:

```bash
alias vsim='python ~/scripts/run_simulation.py'
alias vhw='python ~/scripts/run_hardware.py'
```

Then just:
```bash
vsim .
vhw .
```

### 2. Quick Test Pattern

```bash
# Quick workflow
vsim . --time 500ns     # Verify logic
vhw . --no-program      # Make sure it synthesizes
vhw .                   # Program the FPGA
```

### 3. Keep Source Directories Clean

```bash
# Clean up after experiments
rm -rf vivado_project run_*.tcl
```

Or add to a Makefile:

```makefile
clean:
	rm -rf vivado_project/ *.tcl *.log *.jou
```

### 4. Multiple Designs in One Session

```bash
# Test design 1
cd design1
python ~/scripts/run_simulation.py .

# Test design 2
cd ../design2
python ~/scripts/run_simulation.py .

# Design 1 looks better, program it
cd ../design1
python ~/scripts/run_hardware.py .
```

## ðŸ“š Example Project Structures

### Simple Module
```
simple_adder/
â”œâ”€â”€ adder.v
â”œâ”€â”€ adder_tb.v
â””â”€â”€ Basys3_Master.xdc
```

### Multi-Module Design
```
alarm_system/
â”œâ”€â”€ home_alarm_top.v        # Top module with _top suffix
â”œâ”€â”€ sensor_module.v          # Submodule
â”œâ”€â”€ alarm_control.v          # Submodule
â”œâ”€â”€ home_alarm_tb.v          # Testbench
â””â”€â”€ Basys3_Master.xdc
```

### Lab Assignment
```
lab3_ssd/
â”œâ”€â”€ ssd_display.v
â”œâ”€â”€ ssd_decoder.v
â”œâ”€â”€ ssd_top.v                # Top module
â”œâ”€â”€ ssd_tb.v                 # Testbench
â””â”€â”€ Basys3_Master.xdc
```

All these work with just:
```bash
python run_simulation.py .
python run_hardware.py .
```

## â“ FAQ

**Q: Do I need to create a Vivado project first?**  
A: No! The scripts create a fresh project automatically.

**Q: What if I want to modify the project in Vivado GUI?**  
A: Open `vivado_project/[name].xpr` in Vivado. But remember it'll be recreated next time you run the script.

**Q: Can I use this for class assignments?**  
A: Absolutely! It's your code, just automated. Just make sure your instructor allows automation tools.

**Q: Will this work on Windows?**  
A: Yes, but you'll need Python installed. Path syntax might differ slightly.

**Q: Can I use multiple constraint files?**  
A: Currently it uses the first `.xdc` found. For multiple, you'd need to modify the script.

**Q: What if my testbench doesn't follow the naming convention?**  
A: Rename it to include `_tb`, `_test`, or `testbench` in the filename.

## ðŸŽ“ Perfect for Students!

This workflow is ideal for:
- âœ… Lab assignments (quick iteration)
- âœ… Testing different implementations
- âœ… Learning Verilog (focus on code, not tools)
- âœ… Homework verification
- âœ… Final projects

## ðŸš¦ Next Steps

1. Try it with a simple example:
```bash
mkdir test_and
cd test_and

# Create a simple AND gate
cat > and_gate.v << 'EOF'
module and_gate(
    input a, b,
    output y
);
    assign y = a & b;
endmodule
EOF

# Create testbench
cat > and_gate_tb.v << 'EOF'
module and_gate_tb;
    reg a, b;
    wire y;
    
    and_gate uut(a, b, y);
    
    initial begin
        a = 0; b = 0; #10;
        a = 0; b = 1; #10;
        a = 1; b = 0; #10;
        a = 1; b = 1; #10;
        $finish;
    end
endmodule
EOF

# Run simulation!
python ~/scripts/run_simulation.py . --time 50ns
```

2. Try it with your actual lab assignment

3. Never look back at manual project setup! ðŸŽ‰

## ðŸ“ Summary

**Old way:** Open project, disable files, add files, click, click, click...  
**New way:** `python run_hardware.py .`

Write code. Run script. Done.

Enjoy your newfound productivity! ðŸš€